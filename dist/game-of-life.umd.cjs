(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis<"u"?globalThis:o||self,n(o.GameOfLife={}))})(this,function(o){"use strict";var U=Object.defineProperty;var D=(o,n,c)=>n in o?U(o,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[n]=c;var r=(o,n,c)=>D(o,typeof n!="symbol"?n+"":n,c);function n(e,t){return Math.max(0,Math.round(Math.random()-.3))}function c(e,t=e,s=n){const i=[];for(let h=0;h<e;h++){i[h]=[];for(let l=0;l<t;l++)i[h][l]=s(h,l)}return i}const S=(e,t)=>e===1&&t>3,R=(e,t)=>e===1&&t<2,x=(e,t)=>e===0&&t===3,y=(e,t)=>[x,S,R].map(s=>s(e,t)).includes(!0);function C(e,t,s,i){return e.slice(Math.max(0,t[0]),t[0]+s).map(h=>h.slice(Math.max(0,t[1]),t[1]+i))}function g(e,t){return typeof t=="number"?e+t:t.reduce(g,e)}function T(e,t,s){const i=e[t][s];return C(e,[t-1,s-1],3,3).reduce(g,0-i)}function k(e){return(t,s)=>{const i=e[t][s],h=T(e,t,s);return y(i,h)?+!i:i}}function*f(e={}){const{width:t=10,height:s=10}=e;let i=c(s,t);for(yield i;;)i=c(s,t,k(i)),yield i}const z=1e3/12,M=3,w="rgba(0, 20, 0, 1)",m="rgba(0, 20, 0, 0.3)",v="rgba(0, 200, 0, 1)";let u;class A{constructor({data:t}){r(this,"canvas");r(this,"minInterval");r(this,"cellSize");r(this,"color1");r(this,"color1Tick");r(this,"color2");r(this,"ctx");r(this,"lastDraw");r(this,"gen");r(this,"isPaused");r(this,"hueRotate");this.canvas=t.canvas,this.ctx=this.canvas.getContext("2d"),this.minInterval=t.minInterval??z,this.cellSize=t.cellSize??M,this.color1=t.color1??w,this.color1Tick=t.color1Tick??m,this.color2=t.color2??v,this.lastDraw=0,this.isPaused=!0,this.hueRotate=!!t.hueRotate,this.fillCanvas(this.color1),this.gen=f({width:this.width,height:this.height}),this.draw(),this.isPaused=!!t.paused,this.draw()}get width(){return Math.floor(this.canvas.width/this.cellSize)}set width(t){this.canvas.width!==t&&(this.canvas.width=t,this.gen=f({width:this.width,height:this.height}),this.draw())}get height(){return Math.floor(this.canvas.height/this.cellSize)}set height(t){this.canvas.height!==t&&(this.canvas.height=t,this.gen=f({width:this.width,height:this.height}),this.draw())}set paused(t){this.isPaused=t,t||this.draw()}fillCanvas(t){this.ctx&&(this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}fillCell(t,s,i,h,l){this.ctx&&(this.ctx.fillStyle=l,this.ctx.fillRect(t,s,i,h))}draw(t=0){if(t===0||t-this.lastDraw>this.minInterval){this.hueRotate&&(this.color2=`hsla(${180+Math.sin(this.lastDraw/5e4)*360}, 100%, 50%, 0.8)`),this.lastDraw=t,this.fillCanvas(this.color1Tick);const s=this.gen.next().value;for(let i=0;i<s.length;i++){const h=s[i];for(let l=0;l<h.length;l++)h[l]&&this.fillCell(l*this.cellSize,i*this.cellSize,this.cellSize,this.cellSize,this.color2)}}this.isPaused||requestAnimationFrame(s=>{this.draw(s)})}}self.onmessage=e=>{e.data.canvas?u=new A(e):(u&&e.data.paused!==void 0&&(u.paused=e.data.paused),u&&typeof e.data.width=="number"&&(u.width=e.data.width),u&&typeof e.data.height=="number"&&(u.height=e.data.height))};const b='var R=Object.defineProperty;var D=(o,a,c)=>a in o?R(o,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[a]=c;var n=(o,a,c)=>D(o,typeof a!="symbol"?a+"":a,c);(function(){"use strict";function o(i,t){return Math.max(0,Math.round(Math.random()-.3))}function a(i,t=i,s=o){const e=[];for(let h=0;h<i;h++){e[h]=[];for(let l=0;l<t;l++)e[h][l]=s(h,l)}return e}const c=(i,t)=>i===1&&t>3,f=(i,t)=>i===1&&t<2,g=(i,t)=>i===0&&t===3,w=(i,t)=>[g,c,f].map(s=>s(i,t)).includes(!0);function m(i,t,s,e){return i.slice(Math.max(0,t[0]),t[0]+s).map(h=>h.slice(Math.max(0,t[1]),t[1]+e))}function d(i,t){return typeof t=="number"?i+t:t.reduce(d,i)}function v(i,t,s){const e=i[t][s];return m(i,[t-1,s-1],3,3).reduce(d,0-e)}function x(i){return(t,s)=>{const e=i[t][s],h=v(i,t,s);return w(e,h)?+!e:e}}function*u(i={}){const{width:t=10,height:s=10}=i;let e=a(s,t);for(yield e;;)e=a(s,t,x(e)),yield e}const C=1e3/12,p=3,S="rgba(0, 20, 0, 1)",_="rgba(0, 20, 0, 0.3)",b="rgba(0, 200, 0, 1)";let r;class T{constructor({data:t}){n(this,"canvas");n(this,"minInterval");n(this,"cellSize");n(this,"color1");n(this,"color1Tick");n(this,"color2");n(this,"ctx");n(this,"lastDraw");n(this,"gen");n(this,"isPaused");n(this,"hueRotate");this.canvas=t.canvas,this.ctx=this.canvas.getContext("2d"),this.minInterval=t.minInterval??C,this.cellSize=t.cellSize??p,this.color1=t.color1??S,this.color1Tick=t.color1Tick??_,this.color2=t.color2??b,this.lastDraw=0,this.isPaused=!0,this.hueRotate=!!t.hueRotate,this.fillCanvas(this.color1),this.gen=u({width:this.width,height:this.height}),this.draw(),this.isPaused=!!t.paused,this.draw()}get width(){return Math.floor(this.canvas.width/this.cellSize)}set width(t){this.canvas.width!==t&&(this.canvas.width=t,this.gen=u({width:this.width,height:this.height}),this.draw())}get height(){return Math.floor(this.canvas.height/this.cellSize)}set height(t){this.canvas.height!==t&&(this.canvas.height=t,this.gen=u({width:this.width,height:this.height}),this.draw())}set paused(t){this.isPaused=t,t||this.draw()}fillCanvas(t){this.ctx&&(this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}fillCell(t,s,e,h,l){this.ctx&&(this.ctx.fillStyle=l,this.ctx.fillRect(t,s,e,h))}draw(t=0){if(t===0||t-this.lastDraw>this.minInterval){this.hueRotate&&(this.color2=`hsla(${180+Math.sin(this.lastDraw/5e4)*360}, 100%, 50%, 0.8)`),this.lastDraw=t,this.fillCanvas(this.color1Tick);const s=this.gen.next().value;for(let e=0;e<s.length;e++){const h=s[e];for(let l=0;l<h.length;l++)h[l]&&this.fillCell(l*this.cellSize,e*this.cellSize,this.cellSize,this.cellSize,this.color2)}}this.isPaused||requestAnimationFrame(s=>{this.draw(s)})}}self.onmessage=i=>{i.data.canvas?r=new T(i):(r&&i.data.paused!==void 0&&(r.paused=i.data.paused),r&&typeof i.data.width=="number"&&(r.width=i.data.width),r&&typeof i.data.height=="number"&&(r.height=i.data.height))}})();\n',p=typeof self<"u"&&self.Blob&&new Blob([b],{type:"text/javascript;charset=utf-8"});function L(e){let t;try{if(t=p&&(self.URL||self.webkitURL).createObjectURL(p),!t)throw"";const s=new Worker(t,{name:e==null?void 0:e.name});return s.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(t)}),s}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(b),{name:e==null?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const a=class a extends HTMLElement{useAnimation(){return"matchMedia"in window&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}get cellSize(){return Number.parseInt(this.getAttribute(a.attr.cellSize)??"1",10)}get width(){return this.getAttribute(a.attr.width)||void 0}get height(){return this.getAttribute(a.attr.height)||void 0}get color1(){return this.getAttribute(a.attr.color1)||w}get color1Tick(){return this.getAttribute(a.attr.color1Tick)||m}get color2(){return this.getAttribute(a.attr.color2)||v}get hueRotate(){return!!this.getAttribute(a.attr.hueRotate)}get fps(){return 1e3/Math.max(1,Number.parseInt(this.getAttribute(a.attr.fps)??"12",10))}get shouldShowControls(){return!!this.getAttribute(a.attr.controls)}connectedCallback(){const t=this.attachShadow({mode:"open"}),s=new CSSStyleSheet;s.replaceSync(a.css),t.adoptedStyleSheets=[s];const i=document.createElement("canvas");i.setAttribute("width",String(this.width)),i.setAttribute("height",String(this.height)),i.setAttribute("style",String(this.style)),t.appendChild(i);const h=i.transferControlToOffscreen();new L().postMessage({canvas:h,cellSize:this.cellSize,color1:this.color1,color1Tick:this.color1Tick,color2:this.color2,hueRotate:this.hueRotate,minInterval:this.fps},[h])}};r(a,"tagName","game-of-life"),r(a,"attr",{width:"width",height:"height",color1:"color1",color1Tick:"color1Tick",color2:"color2",cellSize:"cellSize",fps:"fps",style:"style",controls:"controls",hueRotate:"hueRotate"}),r(a,"css",`
        canvas {
            margin: 0;
            padding: 0;
        }
    `);let d=a;customElements.define("game-of-life",d),o.GameOfLife=d,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
